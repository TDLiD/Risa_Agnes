<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
    <title>2026-02 Future Horizon</title>
    <script src="music/music_list.js"></script>
    <style>
        :root{--accent:#00ffa3;--glass:rgba(15,23,42,0.8);--glow:rgba(0,255,163,0.4)}
        body{margin:0;background:#050507;color:white;font-family:'Inter',sans-serif;overflow-x:hidden;min-height:100dvh}
        .nav{position:fixed;top:20px;left:20px;z-index:2000000}
        .btn{padding:10px 18px;border:1px solid var(--accent);color:var(--accent);text-decoration:none;background:rgba(0,0,0,0.5);border-radius:30px;font-weight:bold;font-size:12px}
        #gallery-viewport{display:flex;flex-wrap:wrap;justify-content:center;gap:60px 30px;padding:100px 20px 200px;perspective:1000px}
        .stack-group{position:relative;width:160px;height:220px;transform-style:preserve-3d}
        .photo-card{position:absolute;width:100%;height:100%;border-radius:12px;border:1px solid rgba(255,255,255,0.15);background:var(--glass);overflow:hidden;cursor:pointer;transition:transform .5s cubic-bezier(.23,1,.32,1),opacity .5s;box-shadow:0 5px 15px rgba(0,0,0,0.3);transform-origin:bottom center}
        .photo-card img{width:100%;height:100%;object-fit:cover;pointer-events:none}
        .card-tab{position:absolute;top:0;left:0;right:0;height:25px;background:rgba(0,255,163,0.15);font-size:8px;font-weight:bold;color:var(--accent);display:flex;align-items:center;padding:0 10px}
        .photo-card.swiped{transform:translateY(-120%) rotate(-10deg) scale(0.8)!important;opacity:0;pointer-events:none}
        
        /* 팝업 모달 스타일 */
        #modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);display:none;align-items:center;justify-content:center;z-index:3000000;backdrop-filter:blur(10px);cursor:zoom-out}
        #modal img{max-width:95%;max-height:95%;object-fit:contain;border-radius:8px;box-shadow:0 0 30px var(--glow);transform:scale(0.9);transition:transform 0.3s ease}
        #modal.active img{transform:scale(1)}

        #p-cont{position:fixed;bottom:30px;right:30px;width:280px;background:var(--glass);backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(0,255,163,0.2);border-radius:24px;z-index:1000000;padding:18px;box-shadow:0 25px 50px -12px rgba(0,0,0,0.5);touch-action:none;cursor:grab}
        #p-cont:active{cursor:grabbing}
        .p-header{display:flex;align-items:center;gap:10px;margin-bottom:12px;pointer-events:none}
        .eq{display:flex;align-items:flex-end;gap:2px;height:14px}
        .eq span{width:3px;background:var(--accent);animation:eq .8s ease-in-out infinite alternate}
        @keyframes eq{0%{height:3px}100%{height:14px}}
        .paused .eq span{animation-play-state:paused;height:3px}
        .np-c{flex:1;overflow:hidden}
        .np-l{font-size:8px;text-transform:uppercase;color:var(--accent);letter-spacing:1px}
        #t-name{font-size:12px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .ctrls{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin:12px 0}
        .ctrls button{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:white;cursor:pointer;height:38px;border-radius:10px;font-size:11px;transition:all .3s}
        .ctrls button:hover{background:rgba(0,255,163,0.15);border-color:var(--accent)}
        .pl-w{background:rgba(0,0,0,0.3);border-radius:12px;padding:5px;border:1px solid rgba(255,255,255,0.05)}
        .s-list{max-height:100px;overflow-y:auto;font-size:10px}
        .s-item{padding:6px 10px;cursor:pointer;border-radius:8px;display:flex;align-items:center;transition:.2s;opacity:.6}
        .s-item.active{opacity:1;background:rgba(0,255,163,0.2);color:var(--accent);font-weight:600}
        .s-item .idx{opacity:.4;margin-right:8px;font-family:monospace}
        .s-list::-webkit-scrollbar{width:4px}
        .s-list::-webkit-scrollbar-thumb{background:var(--accent);border-radius:2px}
    </style>
</head>
<body>
    <nav class="nav"><a href="index.html" class="btn">← EXIT</a></nav>
    <div id="gallery-viewport"></div>

    <div id="modal" onclick="closeModal()">
        <img id="modal-img" src="" alt="Zoomed Photo">
    </div>

    <div id="p-cont" class="paused">
        <div class="p-header">
            <div class="eq"><span style="animation-delay:0.1s"></span><span style="animation-delay:0.3s"></span><span style="animation-delay:0.2s"></span><span style="animation-delay:0.4s"></span></div>
            <div class="np-c"><div class="np-l">Now Playing</div><div id="t-name">READY</div></div>
        </div>
        <div class="ctrls">
            <button onclick="prevT()">◁◁</button>
            <button id="p-btn" onclick="toggleP()">PLAY</button>
            <button onclick="stopT()">■</button>
            <button onclick="nextT()">▷▷</button>
        </div>
        <div class="pl-w"><div class="s-list" id="pl"></div></div>
        <audio id="audio"></audio>
    </div>
    <script>
        const audio=document.getElementById('audio'),pBtn=document.getElementById('p-btn'),tName=document.getElementById('t-name'),plEl=document.getElementById('pl'),pCont=document.getElementById('p-cont'),tracks=typeof EXTERNAL_TRACKS!=='undefined'?EXTERNAL_TRACKS:[];
        const modal = document.getElementById('modal'), modalImg = document.getElementById('modal-img');
        let cIdx=0;

        async function loadG(){
            try{
                const res=await fetch('images/photos.json'),data=await res.json(),list=data["2026_02"]||[],view=document.getElementById('gallery-viewport'),size=6;
                for(let i=0;i<list.length;i+=size)createStack(list.slice(i,i+size),view);
            }catch(e){console.error(e)}
        }

        function openModal(src) {
            modalImg.src = src;
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('active'), 10);
        }

        function closeModal() {
            modal.classList.remove('active');
            setTimeout(() => modal.style.display = 'none', 300);
        }

        function createStack(items,cont){
            const group=document.createElement('div');group.className='stack-group';let cards=[];
            items.slice().reverse().forEach((img,idx)=>{
                const card=document.createElement('div');card.className='photo-card';card.style.zIndex=idx;
                const imgSrc = `images/2026-02/${img}`;
                updCard(card,idx,items.length);
                card.innerHTML=`<div class="card-tab">02 / ${img.split('.')[0]}</div><img src="${imgSrc}" loading="lazy">`;
                
                card.onclick=()=>{
                    if(card.style.zIndex!=cards.length-1)return;
                    
                    // 1. 팝업 확대
                    openModal(imgSrc);
                    
                    // 2. 음악 재생 및 카드 스와이프 (기존 기능)
                    if(audio.paused)toggleP();
                    card.classList.add('swiped');
                    setTimeout(()=>{
                        card.classList.remove('swiped');
                        cards.forEach(c=>{
                            let z=parseInt(c.style.zIndex);
                            c.style.zIndex=(c===card)?0:z+1;
                            updCard(c,parseInt(c.style.zIndex),items.length);
                        });
                        cards.unshift(cards.pop());
                    },500);
                };
                group.appendChild(card);cards.push(card);
            });
            cont.appendChild(group);
        }

        function updCard(c,z,t){const i=t-1-z;c.style.transform=`translate3d(0,${i*-4}px,${i*-10}px) rotate(${i*1.5+(Math.random()-0.5)*2}deg)`}
        
        function initP(){
            if(!tracks.length)return;plEl.innerHTML='';
            tracks.forEach((t,i)=>{
                const item=document.createElement('div');item.className=`s-item ${i===cIdx?'active':''}`;
                item.innerHTML=`<span class="idx">${String(i+1).padStart(2,'0')}</span><span>${t.replace('.mp3','').replace(/_/g,' ')}</span>`;
                item.onclick=(e)=>{e.stopPropagation();loadT(i)};
                plEl.appendChild(item);
            });
            loadT(cIdx,false);
        }

        function loadT(idx,a=true){
            if(!tracks.length)return;cIdx=idx;audio.src=`music/${tracks[idx]}`;
            tName.innerText=tracks[idx].replace('.mp3','').replace(/_/g,' ');
            document.querySelectorAll('.s-item').forEach((it,i)=>it.classList.toggle('active',i===idx));
            if(a)audio.play().then(()=>updUI(true)).catch(e=>{});else updUI(false);
        }

        function toggleP(){if(audio.paused)audio.play().then(()=>updUI(true));else{audio.pause();updUI(false)}}
        function updUI(p){if(p){pCont.classList.remove('paused');pBtn.innerText="PAUSE"}else{pCont.classList.add('paused');pBtn.innerText="PLAY"}}
        function nextT(){cIdx=(cIdx+1)%tracks.length;loadT(cIdx)}
        function prevT(){cIdx=(cIdx-1+tracks.length)%tracks.length;loadT(cIdx)}
        function stopT(){audio.pause();audio.currentTime=0;updUI(false)}
        
        audio.onended=nextT;
        let isDrag=false,sX,sY,iX,iY;
        const sD=(e)=>{
            if(e.target.closest('button')||e.target.closest('.s-list')||e.target.closest('#modal'))return;
            isDrag=true;const cX=e.type==='touchstart'?e.touches[0].clientX:e.clientX,cY=e.type==='touchstart'?e.touches[0].clientY:e.clientY;
            const r=pCont.getBoundingClientRect();sX=cX;sY=cY;iX=r.left;iY=r.top;
        };
        const oD=(e)=>{
            if(!isDrag)return;const cX=e.type==='touchmove'?e.touches[0].clientX:e.clientX,cY=e.type==='touchmove'?e.touches[0].clientY:e.clientY;
            pCont.style.left=`${iX+(cX-sX)}px`;pCont.style.top=`${iY+(cY-sY)}px`;pCont.style.right='auto';pCont.style.bottom='auto';
        };
        pCont.addEventListener('mousedown',sD);pCont.addEventListener('touchstart',sD,{passive:false});
        window.addEventListener('mousemove',oD);window.addEventListener('touchmove',oD,{passive:false});
        window.addEventListener('mouseup',()=>isDrag=false);window.addEventListener('touchend',()=>isDrag=false);
        window.onload=()=>{loadG();initP()};
    </script>
</body>
</html>
