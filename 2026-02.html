<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
    <title>2026-02 Future Horizon</title>
    <script src="music/music_list.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/granim/2.0.0/granim.min.js"></script>
    <style>
        :root{--accent:#00ffa3;--glass:rgba(15,23,42,0.8);--glow:rgba(0,255,163,0.4);--heart-red:#ff4d6d}
        body{margin:0;background:#050507;color:white;font-family:'Inter',sans-serif;overflow:hidden;height:100dvh;position:fixed;width:100%}
        
        /* 고정 배경 이미지 설정 */
        #fixed-bg{
            position: fixed;
            inset: 0;
            z-index: -3;
            background: url('images/2026-02/bg.png') no-repeat center center;
            background-size: cover;
            filter: brightness(0.5);
        }

        #canvas-bg{position:fixed;inset:0;z-index:-2; opacity: 0.4; mix-blend-mode: screen;}
        
        /* 3D 갤러리 관련 스타일 */
        #main-scroller{position:absolute;inset:0;overflow:hidden;perspective:2000px;z-index:1}
        #sphere-scene{position:absolute;top:50%;left:50%;width:0;height:0;transform-style:preserve-3d;animation:rotateSphere 60s linear infinite;transition:all .8s}
        @keyframes rotateSphere{from{transform:translate(-50%,-50%) rotateX(-5deg) rotateY(0deg)}to{transform:translate(-50%,-50%) rotateX(-5deg) rotateY(360deg)}}
        
        /* 카드 크기 반응형 수정 */
        .photo-card{
            position:absolute;
            width:140px; height:180px; /* 기본 크기 약간 축소 */
            left:-70px; top:-90px;
            border-radius:12px;
            border:1px solid rgba(255,255,255,0.2);
            background:var(--glass);
            overflow:hidden;
            cursor:pointer;
            transition:all .5s;
            filter:brightness(.8);
            backface-visibility:hidden;
            box-shadow:0 0 15px rgba(0,0,0,0.5);
        }

        @media (max-width: 768px) {
            .photo-card {
                width: 100px; height: 130px; /* 모바일에서 더 작게 */
                left: -50px; top: -65px;
            }
        }

        .photo-card:hover{filter:brightness(1);border-color:var(--accent);box-shadow:0 0 20px var(--glow)}
        .photo-card img{width:100%;height:100%;object-fit:cover}

        /* 네비게이션 & UI */
        .nav{position:fixed;top:max(20px, env(safe-area-inset-top));left:20px;z-index:2000000}
        .btn{padding:8px 15px;border:1px solid var(--accent);color:var(--accent);text-decoration:none;background:rgba(0,0,0,0.5);border-radius:30px;font-weight:bold;font-size:11px}
        
        .bottom-nav{position:fixed;bottom:max(20px,env(safe-area-inset-bottom));left:20px;z-index:9999}
        #ai-rank-btn{
            padding:0 20px; height:44px;
            background:rgba(0,0,0,.8); border:1px solid var(--accent); color:var(--accent);
            border-radius:22px; cursor:pointer; font-weight:bold; font-size:11px;
            backdrop-filter:blur(15px); box-shadow:0 0 15px var(--glow);
        }

        /* 뮤직 플레이어 반응형 수정 */
        #p-cont{
            position:fixed; bottom:max(20px, env(safe-area-inset-bottom)); right:20px;
            width:260px; background:var(--glass); backdrop-filter:blur(20px);
            border:1px solid rgba(0,255,163,0.2); border-radius:20px;
            z-index:1000000; padding:15px; box-shadow:0 15px 35px rgba(0,0,0,0.5);
            touch-action:none;
        }

        @media (max-width: 480px) {
            #p-cont {
                width: calc(100% - 40px); /* 모바일에서는 가로폭을 넓게 */
                left: 20px; right: 20px;
                padding: 12px;
            }
            .ctrls button { height: 34px; font-size: 10px; }
        }

        .p-header{display:flex;align-items:center;gap:10px;margin-bottom:10px;pointer-events:none}
        .eq{display:flex;align-items:flex-end;gap:2px;height:12px}
        .eq span{width:2px;background:var(--accent);animation:eq .8s ease-in-out infinite alternate}
        @keyframes eq{0%{height:3px}100%{height:12px}}
        .paused .eq span{animation-play-state:paused;height:3px}
        #t-name{font-size:11px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .ctrls{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin:10px 0}
        .ctrls button{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:white;cursor:pointer;border-radius:8px;}
        .s-list{max-height:60px;overflow-y:auto;font-size:9px;background:rgba(0,0,0,0.3);border-radius:8px;padding:5px}
        .s-item{padding:5px 8px;cursor:pointer;border-radius:6px;opacity:.6}
        .s-item.active{opacity:1;background:rgba(0,255,163,0.2);color:var(--accent)}

        /* 스캔 오버레이 & 모달 */
        #proc-ov{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:2000000;backdrop-filter:blur(15px)}
        .loader{width:180px;height:3px;background:rgba(255,255,255,.1);margin-top:20px;border-radius:2px;position:relative;overflow:hidden}
        .l-bar{width:0%;height:100%;background:var(--accent);position:absolute;transition:width .2s}
        
        #modal{position:fixed;inset:0;background:rgba(0,0,0,0.95);display:none;align-items:center;justify-content:center;z-index:3000000;backdrop-filter:blur(10px)}
        #modal img{max-width:95%;max-height:85%;border-radius:8px;box-shadow:0 0 30px var(--glow); object-fit: contain;}
    </style>
</head>
<body>
    <div id="fixed-bg"></div>
    <canvas id="canvas-bg"></canvas>

    <nav class="nav"><a href="index.html" class="btn">← EXIT</a></nav>
    
    <div id="main-scroller">
        <div id="sphere-scene"></div>
    </div>

    <div class="bottom-nav">
        <button id="ai-rank-btn">SCAN BEST PHOTO</button>
    </div>

    <div id="p-cont" class="paused">
        <div class="p-header">
            <div class="eq"><span></span><span></span><span></span><span></span></div>
            <div class="np-c"><div style="font-size:7px;color:var(--accent);text-transform:uppercase;">Now Playing</div><div id="t-name">READY</div></div>
        </div>
        <div class="ctrls">
            <button onclick="prevT()">◁◁</button>
            <button id="p-btn" onclick="toggleP()">PLAY</button>
            <button onclick="stopT()">■</button>
            <button onclick="nextT()">▷▷</button>
        </div>
        <div class="s-list" id="pl"></div>
        <audio id="audio" playsinline></audio>
    </div>

    <div id="proc-ov">
        <div style="color:var(--accent);letter-spacing:2px;font-size:12px;">AI SCANNING...</div>
        <div class="loader"><div class="l-bar" id="p-bar"></div></div>
    </div>

    <div id="modal" onclick="closeM()"><img id="m-img" src=""></div>

    <script>
        const audio=document.getElementById('audio'), pBtn=document.getElementById('p-btn'), tName=document.getElementById('t-name'), plEl=document.getElementById('pl'), pCont=document.getElementById('p-cont'), tracks=typeof EXTERNAL_TRACKS!=='undefined'?EXTERNAL_TRACKS:[];
        const scene=document.getElementById('sphere-scene'), modal=document.getElementById('modal'), mImg=document.getElementById('m-img');
        let cIdx=0, cards=[];

        new Granim({element:'#canvas-bg',direction:'top-bottom',states:{"default-state":{gradients:[['#050507','#1a0f2e'],['#0f172a','#050507']],transitionSpeed:8000}}});

        async function loadG(){
            try{
                const res=await fetch('images/photos.json'), data=await res.json(), photos=data["2026_02"]||[];
                const count=photos.length;
                // 모바일 환경에 따른 구체 반지름 조절
                const radius=window.innerWidth<768?220:450;
                
                photos.forEach((f,i)=>{
                    const img=document.createElement('div');
                    img.className='photo-card';
                    
                    const phi = Math.acos(-1 + (2 * i) / count);
                    const theta = Math.sqrt(count * Math.PI) * phi;
                    const x = radius * Math.sin(phi) * Math.cos(theta);
                    const y = radius * Math.sin(phi) * Math.sin(theta);
                    const z = radius * Math.cos(phi);
                    
                    img.style.transform = `translate3d(${x}px,${y}px,${z}px) rotateY(${theta}rad) rotateX(${phi-Math.PI/2}rad)`;
                    img.innerHTML = `<img src="images/2026-02/${f}" loading="lazy">`;
                    
                    img.onclick=(e)=>{
                        e.stopPropagation();
                        openM(`images/2026-02/${f}`);
                        if(audio.paused) toggleP();
                    };
                    
                    scene.appendChild(img);
                    cards.push(img);
                });
            }catch(e){console.error(e)}
        }

        document.getElementById('ai-rank-btn').onclick=()=>{
            const ov=document.getElementById('proc-ov'), bar=document.getElementById('p-bar');
            ov.style.display='flex'; bar.style.width='0%';
            setTimeout(()=>bar.style.width='100%', 100);
            setTimeout(()=>{
                ov.style.display='none';
                const randomCard = cards[Math.floor(Math.random()*cards.length)];
                openM(randomCard.querySelector('img').src);
            }, 1500);
        };

        function openM(s){mImg.src=s; modal.style.display='flex'}
        function closeM(){modal.style.display='none'}

        function initP(){
            if(!tracks.length)return;
            plEl.innerHTML=tracks.map((t,i)=>`<div class="s-item ${i===cIdx?'active':''}" onclick="loadT(${i})">${String(i+1).padStart(2,'0')} ${t.replace('.mp3','').replace(/_/g,' ')}</div>`).join('');
            loadT(cIdx,false);
        }
        function loadT(idx,a=true){
            cIdx=idx; audio.src=`music/${tracks[idx]}`; tName.innerText=tracks[idx].replace('.mp3','').replace(/_/g,' ');
            document.querySelectorAll('.s-item').forEach((it,i)=>it.classList.toggle('active',i===idx));
            if(a)audio.play().then(()=>updUI(true)).catch(e=>{}); else updUI(false);
        }
        function toggleP(){if(audio.paused)audio.play().then(()=>updUI(true)).catch(e=>{});else{audio.pause();updUI(false)}}
        function updUI(p){pCont.classList.toggle('paused',!p);pBtn.innerText=p?"PAUSE":"PLAY"}
        function nextT(){cIdx=(cIdx+1)%tracks.length;loadT(cIdx)}
        function prevT(){cIdx=(cIdx-1+tracks.length)%tracks.length;loadT(cIdx)}
        function stopT(){audio.pause();audio.currentTime=0;updUI(false)}
        audio.onended=nextT;

        // 터치 드래그 지원 (모바일 전용 최적화)
        let isDrag=false,sX,sY,iX,iY;
        const dragStart=(e)=>{
            if(e.target.closest('button')||e.target.closest('.s-list'))return;
            isDrag=true; const c=e.type.includes('touch')?e.touches[0]:e;
            const r=pCont.getBoundingClientRect(); sX=c.clientX; sY=c.clientY; iX=r.left; iY=r.top;
        };
        const dragMove=(e)=>{
            if(!isDrag)return; const c=e.type.includes('touch')?e.touches[0]:e;
            pCont.style.left=`${iX+(c.clientX-sX)}px`; pCont.style.top=`${iY+(c.clientY-sY)}px`;
            pCont.style.right='auto'; pCont.style.bottom='auto';
        };
        pCont.addEventListener('mousedown',dragStart); pCont.addEventListener('touchstart',dragStart);
        window.addEventListener('mousemove',dragMove); window.addEventListener('touchmove',dragMove, {passive:false});
        window.addEventListener('mouseup',()=>isDrag=false); window.addEventListener('touchend',()=>isDrag=false);

        window.onload=()=>{loadG();initP()};
    </script>
</body>
</html>
