<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 Future Gallery</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/granim/2.0.0/granim.min.js"></script>
    <style>
        :root { --accent:#00ffa3; --glow:rgba(0,255,163,0.4); --heart-red:#ff4d6d; }
        
        /* 1. ê¸°ë³¸ ë ˆì´ì•„ì›ƒ: ìŠ¤í¬ë¡¤ ë´‰ì‡„ */
        html, body { margin:0; padding:0; width:100%; height:100dvh; background:#050507; overflow:hidden; position:fixed; }
        body { color:white; font-family:'Inter',sans-serif; -webkit-tap-highlight-color:transparent; }

        /* 2. ìŠ¤í¬ë¡¤ ì „ìš© ì»¨í…Œì´ë„ˆ (ê·¸ë¦¬ë“œ ëª¨ë“œ ì‹œ ì—¬ê¸°ì„œë§Œ ìŠ¤í¬ë¡¤ ë°œìƒ) */
        #main-scroller { 
            position:absolute; inset:0; overflow-x:hidden; overflow-y:hidden; 
            perspective:2000px; z-index:1; -webkit-overflow-scrolling:touch; 
        }
        body.grid-mode #main-scroller { overflow-y:auto; }

        #canvas-bg { position:fixed; inset:0; z-index:-2; pointer-events:none; }
        #sphere-scene { position:absolute; top:50%; left:50%; width:0; height:0; transform-style:preserve-3d; animation:rotateEarth 30s linear infinite; transition:all 0.8s; }
        
        /* 3. ê²©ì ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        body.grid-mode #sphere-scene { 
            animation:none!important; transform:none!important; position:relative!important; 
            top:0!important; left:0!important; width:100%!important; height:auto!important; 
            display:grid!important; grid-template-columns:repeat(auto-fill, minmax(140px, 1fr))!important; 
            gap:15px!important; padding:80px 20px 180px 20px!important; box-sizing:border-box!important; 
        }

        @keyframes rotateEarth { from { transform:translate(-50%,-50%) rotateX(-5deg) rotateY(0deg); } to { transform:translate(-50%,-50%) rotateX(-5deg) rotateY(360deg); } }

        .photo-card { position:absolute; width:150px; height:150px; left:-75px; top:-75px; object-fit:cover; border-radius:12px; border:2px solid rgba(255,255,255,0.2); cursor:pointer; transition:all 0.6s; filter:brightness(0.7); backface-visibility:hidden; }
        body.grid-mode .photo-card { position:relative!important; left:0!important; top:0!important; width:100%!important; height:auto!important; aspect-ratio:1/1; transform:none!important; filter:brightness(1); }

        /* 4. ğŸ“Œ í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .bottom-nav { 
            position:fixed!important; 
            bottom:max(30px, env(safe-area-inset-bottom))!important; 
            left:50%!important; 
            transform:translateX(-50%)!important; 
            z-index:999999!important; 
            display:flex!important; 
            align-items:center; gap:15px; 
            pointer-events:auto!important; 
            width:max-content; 
        }

        #heart-btn { width:60px; height:60px; background:var(--heart-red); border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; border:none; box-shadow:0 0 25px rgba(255,77,109,0.6); flex-shrink:0; }
        #ai-rank-btn { padding:0 25px; height:50px; background:rgba(0,0,0,0.9); border:1px solid var(--accent); color:var(--accent); border-radius:25px; cursor:pointer; font-weight:bold; backdrop-filter:blur(15px); white-space:nowrap; flex-shrink:0; }
        
        /* ê¸°íƒ€ UI */
        .nav { position:fixed; top:20px; left:20px; z-index:1000000; }
        .btn { padding:10px 18px; border:1px solid var(--accent); color:var(--accent); text-decoration:none; background:rgba(0,0,0,0.5); border-radius:30px; font-weight:bold; }
        #processing-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.85); display:none; flex-direction:column; align-items:center; justify-content:center; z-index:2000000; backdrop-filter:blur(15px); }
        .loader { width:220px; height:4px; background:rgba(255,255,255,0.1); margin-top:25px; border-radius:2px; position:relative; overflow:hidden; }
        .loader-bar { width:0%; height:100%; background:var(--accent); position:absolute; }
        #modal { position:fixed; inset:0; background:rgba(0,0,0,0.95); display:none; align-items:center; justify-content:center; z-index:3000000; backdrop-filter:blur(20px); }

        /* ì˜¤ë””ì˜¤ ìˆ¨ê¸°ê¸° */
        #bg-music { display: none; }
    </style>
</head>
<body>
    <audio id="bg-music" loop>
        <source src="music/DDU_DU_DDU_DU.mp3" type="audio/mpeg">
    </audio>

    <canvas id="canvas-bg"></canvas>
    <nav class="nav"><a href="index.html" class="btn">â† EXIT</a></nav>

    <div id="main-scroller">
        <div id="sphere-scene"></div>
    </div>
    
    <div class="bottom-nav">
        <button id="heart-btn">
            <svg viewBox="0 0 24 24" width="30" height="30" fill="white"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
        </button>
        <button id="ai-rank-btn">WHICH ONE IS THE PRETTIEST?</button>
    </div>

    <div id="processing-overlay">
        <div class="proc-text" id="proc-status" style="color:var(--accent)">SCANNING...</div>
        <div class="loader"><div class="loader-bar" id="proc-bar"></div></div>
    </div>

    <div id="modal" onclick="closeModal()"><img id="modal-img" src="" style="max-width:90%; max-height:80%;"></div>

    <script>
        // ğŸµ ìŒì•… ì¬ìƒ ë¡œì§
        const music = document.getElementById('bg-music');
        function playMusic() {
            if (music.paused) {
                music.play().catch(e => console.log("Music play blocked"));
                // ì¬ìƒ ì‹œì‘ ì‹œ ì´ë²¤íŠ¸ ì œê±°
                window.removeEventListener('click', playMusic);
                window.removeEventListener('touchstart', playMusic);
            }
        }
        // ì‚¬ìš©ìê°€ í˜ì´ì§€ì˜ ì–´ëŠ ê³³ì´ë“  í´ë¦­/í„°ì¹˜í•˜ë©´ ìŒì•… ì‹œì‘
        window.addEventListener('click', playMusic);
        window.addEventListener('touchstart', playMusic);

        const scroller = document.getElementById('main-scroller');
        const scene = document.getElementById('sphere-scene');
        
        document.getElementById('heart-btn').onclick = () => {
            const isGrid = document.body.classList.toggle('grid-mode');
            cards.forEach(c => c.style.transform = isGrid ? 'none' : c.dataset.sphereTransform);
            scroller.scrollTop = 0;
            playMusic(); // ë²„íŠ¼ í´ë¦­ ì‹œì—ë„ ìŒì•… ì¬ìƒ ì‹œë„
        };

        const granimInstance = new Granim({
            element: '#canvas-bg', direction: 'top-bottom',
            states : { "default-state": { gradients: [['#050507', '#1a0f2e'], ['#0f172a', '#050507']], transitionSpeed: 8000 } }
        });
        
        const modal = document.getElementById('modal'), modalImg = document.getElementById('modal-img'), aiBtn = document.getElementById('ai-rank-btn');
        const procOverlay = document.getElementById('processing-overlay'), procBar = document.getElementById('proc-bar');
        const count = 37, cards = [], radius = window.innerWidth < 768 ? 250 : 450;
        
        for (let i = 0; i < count; i++) {
            const index = i + 1, num = String(index).padStart(3, '0'), ext = index <= 19 ? 'jpg' : 'png', src = `images/image-${num}.${ext}`;
            const img = document.createElement('img');
            img.src = src; img.className = 'photo-card';
            const phi = Math.acos(-1 + (2 * i) / count), theta = Math.sqrt(count * Math.PI) * phi;
            const x = radius * Math.sin(phi) * Math.cos(theta), y = radius * Math.sin(phi) * Math.sin(theta), z = radius * Math.cos(phi);
            const tf = `translate3d(${x}px, ${y}px, ${z}px) rotateY(${theta}rad) rotateX(${phi - Math.PI/2}rad)`;
            img.style.transform = tf; img.dataset.sphereTransform = tf;
            
            img.onclick = (e) => { 
                e.stopPropagation(); 
                openModal(src); 
                playMusic(); // ì‚¬ì§„ í´ë¦­ ì‹œì—ë„ ìŒì•… ì¬ìƒ ì‹œë„
            };
            scene.appendChild(img); cards.push(img);
        }
        
        function openModal(src) { modalImg.src = src; modal.style.display = 'flex'; }
        function closeModal() { modal.style.display = 'none'; }
        
        aiBtn.onclick = async function() { 
            playMusic(); // AI ë²„íŠ¼ í´ë¦­ ì‹œì—ë„ ìŒì•… ì¬ìƒ ì‹œë„
            procOverlay.style.display = 'flex';
            setTimeout(() => { 
                procOverlay.style.display = 'none'; 
                openModal(cards[Math.floor(Math.random()*count)].src); 
            }, 2000);
        };
    </script>
</body>
</html>